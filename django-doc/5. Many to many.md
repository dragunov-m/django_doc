Связь многие ко многим описывает ситуацию, когда объект первой модели может одновременно ассоциироваться с несколькими объектами второй модели. И наоборот, один объект второй модели может также одновременно быть ассоциирован с несколькими объектами первой модели. Например, один студент может посещать несколько курсов, а один курс могут посещать несколько студентов.

Для создания отношения многие ко многим применяется тип __ManyToManyField__.

```python
class Course(models.Model):
    name = models.CharField(max_length=30)
 
class Student(models.Model):
    name = models.CharField(max_length=30)
    courses = models.ManyToManyField(Course)
```

В конструктор __models.ManyToManyField__ передается сущность, с которой устанавливается отношение многие ко многим. В результате будет создаваться промежуточная таблица, через которую собственно и будет осуществляться связь.

## Операции с моделями

Через свойство __courses__ в модели __Student__ мы можем получать связанные со студентом курсы и управлять ими.

```python
# создадим студента
tom = Student.objects.create(name="Tom")
 
# создадим один курс и добавим его в список курсов Тома
tom.courses.create(name="Algebra")
 
# получим все курсы студента
courses = Student.objects.get(name="Tom").courses.all()
 
# получаем всех студентов, которые посещают курс Алгебра
students = Student.objects.filter(courses__name="Algebra")
```

Стоит отметить последний случай, где производится фильтрация студентов по посещаемому курсу. Для передачи в метод __filter__ названия курса используется параметр, название которого начинается с названия свойства, через которое идет связь со второй моделью. И далее через два знака подчеркивания указывается имя свойства второй модели, например, __courses__name__ или __courses__id__.

В данном случае мы можем получить информацию о курсах студента через свойство courses, которое определено в модели __Student__. Однако что если мы хотим получить информацию о студентах по определенному курсу? В этом случае нам надо использовать синтаксис ____set__.

```python
# создадим курс
python = Course.objects.create(name="Python")
 
# создаем студента и добавляем его на курс
python.student_set.create(name="Bob")
 
# отдельно создаем студента и добавляем его на курс
sam = Student(name="Sam")
sam.save()
python.student_set.add(sam)
 
# получим всех студентов курса
students = python.student_set.all()
 
# получим количество студентов по курсу
number = python.student_set.count()
 
# удялем с курса одного студента
python.student_set.remove(sam)
 
# удаляем всех студентов с курса
python.student_set.clear()
```

Как модели выглядят в бд:

![[Pasted image 20230219213658.png]]
![[Pasted image 20230219213717.png]]
![[Pasted image 20230219213738.png]]